@* <h3>ExerciseForm</h3> *@

@using Hits.Blazor.DmitrievLR.FitnessTracker.Models
@using Hits.Blazor.DmitrievLR.FitnessTracker.Services
@rendermode InteractiveServer
@inject ExerciseService ExerciseService

@if (visible)
{
    <div class="card mb-4">
        <div class="card-body">
            <h5>@(model.Id == 0 ? "Новое упражнение" : "Редактирование")</h5>

            <div class="mb-3">
                <label class="form-label">Название</label>
                <input class="form-control" @bind="model.Name" />
            </div>

            <div class="mb-3">
                <label class="form-label">Тип</label>
                <select class="form-select" @bind="model.Type">
                    <option value="Strength">Силовое</option>
                    <option value="Cardio">Кардио</option>
                </select>
            </div>

            <div class="mb-3">
                <label class="form-label">Описание</label>
                <textarea class="form-control" @bind="model.Description"></textarea>
            </div>

            <button class="btn btn-success me-2" @onclick="Save">
                Сохранить
            </button>
            <button class="btn btn-secondary" @onclick="Close">
                Отмена
            </button>
        </div>
    </div>
}

@code {
    private bool visible;
    private Exercise model = new();

    [Parameter]
    public EventCallback OnSaved { get; set; }

    public void Show(Exercise exercise)
    {
        model = exercise;
        visible = true;
        StateHasChanged();
    }

    private async Task Save()
    {
        if (model.Id == 0)
            await ExerciseService.AddAsync(model);
        else
            await ExerciseService.UpdateAsync(model);

        visible = false;
        await OnSaved.InvokeAsync();
    }

    private void Close()
    {
        visible = false;
    }
}
